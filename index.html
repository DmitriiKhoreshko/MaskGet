<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Важно для мобильных -->
    <title>Image Cropper</title>
    <!-- Подключаем стили Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background: #f0f2f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* Контейнер для изображения. Обязательно ограничить высоту/ширину */
        .img-container {
            max-width: 100%;
            height: 400px; /* Фиксированная высота для удобства на телефоне */
            margin: 20px 0;
            background-color: #f7f7f7;
            overflow: hidden; 
        }
        
        img { max-width: 100%; display: block; } /* display: block обязателен для cropper.js */

        .btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        button {
            padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; font-size: 16px;
            background-color: #007bff; color: white; transition: 0.2s;
        }
        button.secondary { background-color: #6c757d; }
        button:active { transform: scale(0.98); }
        
        #result { margin-top: 20px; font-weight: bold; word-break: break-all; }
        #cropped-img { max-width: 200px; border: 1px solid #ccc; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>Загрузка и выбор области</h2>
    
    <!-- Поле загрузки -->
    <input type="file" id="imageInput" accept="image/*">
    
    <!-- Область редактирования -->
    <div class="img-container">
        <img id="image" src="" alt="Select an image">
    </div>

    <!-- Кнопки управления -->
    <div class="btn-group">
        <button id="btnCrop">Получить кроп</button>
        <button id="btnClear" class="secondary">Снять выделение</button>
        <button id="btnReset" class="secondary">Сброс</button>
    </div>

    <div id="result">
        <img id="cropped-img" src="">
    </div>
</div>

<!-- Подключаем скрипт Cropper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script>
    const image = document.getElementById('image');
    const input = document.getElementById('imageInput');
    const resultImg = document.getElementById('cropped-img');
    let cropper;

    // 1. Обработка загрузки файла
    input.addEventListener('change', (e) => {
        const files = e.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const reader = new FileReader();
            
            reader.onload = (event) => {
                image.src = event.target.result;
                
                // Если кроппер уже был создан, удаляем старый перед созданием нового
                if (cropper) {
                    cropper.destroy();
                }
                
                // Инициализация Cropper.js
                cropper = new Cropper(image, {
                    viewMode: 1, // Ограничить кроп рамками изображения
                    responsive: true, // Адаптивность при повороте экрана
                    autoCrop: true, // Сразу показывать рамку (можно false)
                    ready() {
                        // Можно добавить логику после загрузки
                    }
                });
            };
            reader.readAsDataURL(file);
        }
    });

    // 2. Получение результата (Кроп)
    document.getElementById('btnCrop').addEventListener('click', () => {
        if (!cropper) return;
        
        // Получаем Canvas с обрезанной областью
        const canvas = cropper.getCroppedCanvas();
        
        // Преобразуем в картинку для показа
        resultImg.src = canvas.toDataURL("image/jpeg");
        resultImg.style.display = 'block';
        
        // Если нужны координаты для ML-модели на бэкенде:
        const data = cropper.getData();
        console.log("Координаты:", data); // x, y, width, height
    });

    // 3. Снять выделение (требование: "отменить выделение")
    document.getElementById('btnClear').addEventListener('click', () => {
        if (cropper) cropper.clear(); // Убирает синюю рамку
    });

    // 4. Сброс к исходному состоянию
    document.getElementById('btnReset').addEventListener('click', () => {
        if (cropper) cropper.reset();
    });
</script>

</body>
</html>
